
instance DIA_Fernando_EXIT(C_Info)
{
	npc = VLK_405_Fernando;
	nr = 999;
	condition = DIA_Fernando_EXIT_Condition;
	information = DIA_Fernando_EXIT_Info;
	permanent = TRUE;
	description = Dialog_Ende;
};


func int DIA_Fernando_EXIT_Condition()
{
	return TRUE;
};

func void DIA_Fernando_EXIT_Info()
{
	B_NpcClearObsessionByDMT(self);
};


instance DIA_Fernando_PICKPOCKET(C_Info)
{
	npc = VLK_405_Fernando;
	nr = 900;
	condition = DIA_Fernando_PICKPOCKET_Condition;
	information = DIA_Fernando_PICKPOCKET_Info;
	permanent = TRUE;
	description = Pickpocket_60;
};


func int DIA_Fernando_PICKPOCKET_Condition()
{
	if(Npc_HasItems(self,ItSe_GoldPocket100) && (NpcObsessedByDMT_Fernando == FALSE))
	{
		return C_CanStealFromNpc(50);
	};
	return FALSE;
};

func void DIA_Fernando_PICKPOCKET_Info()
{
	Info_ClearChoices(DIA_Fernando_PICKPOCKET);
	Info_AddChoice(DIA_Fernando_PICKPOCKET,Dialog_Back,DIA_Fernando_PICKPOCKET_BACK);
	Info_AddChoice(DIA_Fernando_PICKPOCKET,DIALOG_PICKPOCKET,DIA_Fernando_PICKPOCKET_DoIt);
};

func void DIA_Fernando_PICKPOCKET_DoIt()
{
	B_StealItem(50,ItSe_GoldPocket100,1);
	Info_ClearChoices(DIA_Fernando_PICKPOCKET);
};

func void DIA_Fernando_PICKPOCKET_BACK()
{
	Info_ClearChoices(DIA_Fernando_PICKPOCKET);
};


instance DIA_Fernando_Hello(C_Info)
{
	npc = VLK_405_Fernando;
	nr = 5;
	condition = DIA_Fernando_Hello_Condition;
	information = DIA_Fernando_Hello_Info;
	permanent = FALSE;
	description = "Как идут дела?";
};


func int DIA_Fernando_Hello_Condition()
{
	if((NpcObsessedByDMT_Fernando == FALSE) && (Fernando_ImKnast == FALSE))
	{
		return TRUE;
	};
};

func void DIA_Fernando_Hello_Info()
{
	AI_Output(other,self,"DIA_Fernando_Hello_15_00");	//Как идут дела?
	AI_Output(self,other,"DIA_Fernando_Hello_14_01");	//Не сказать, чтобы очень хорошо. Когда Барьер все еще стоял, времена были получше.
	AI_Output(self,other,"DIA_Fernando_Hello_14_02");	//Заключенные добывали руду в шахтах, а мои корабли доставляли ее на материк.
	AI_Output(self,other,"DIA_Fernando_Hello_14_03");	//А на обратном пути они доставляли пищу и другие товары.
	AI_Output(self,other,"DIA_Fernando_Hello_14_04");	//Но сейчас мы отрезаны от материка, и нам приходится рассчитывать только на фермеров в том, что касается припасов.
};


instance DIA_Fernando_Perm(C_Info)
{
	npc = VLK_405_Fernando;
	nr = 850;
	condition = DIA_Fernando_Perm_Condition;
	information = DIA_Fernando_Perm_Info;
	permanent = TRUE;
	description = "И чем ты сейчас зарабатываешь на жизнь?";
};


func int DIA_Fernando_Perm_Condition()
{
	if(Npc_KnowsInfo(other,DIA_Fernando_Hello) && (NpcObsessedByDMT_Fernando == FALSE) && (Fernando_ImKnast == FALSE))
	{
		return TRUE;
	};
};

func void DIA_Fernando_Perm_Info()
{
	AI_Output(other,self,"DIA_Fernando_Perm_15_00");	//И чем ты сейчас зарабатываешь на жизнь?
	if(Fernando_HatsZugegeben == TRUE)
	{
		AI_Output(self,other,"DIA_Addon_Fernando_Perm_14_00");	//Пока ничем. Но в любом случае, темными делами я больше не занимаюсь. Это точно.
	}
	else if(!Npc_KnowsInfo(other,DIA_Fernando_Success))
	{
		AI_Output(self,other,"DIA_Fernando_Perm_14_01");	//Ничем! Сейчас я живу только за счет накопленного ранее. Но если я не смогу найти источник дохода, скоро для меня настанут тяжелые времена.
	}
	else
	{
		AI_Output(self,other,"DIA_Fernando_Perm_14_02");	//Я разорен. Мне стоило послушать моего отца и держаться подальше от этого горнодобывающего бизнеса.
	};
};


instance DIA_Fernando_Minental(C_Info)
{
	npc = VLK_405_Fernando;
	nr = 2;
	condition = DIA_Fernando_Minental_Condition;
	information = DIA_Fernando_Minental_Info;
	permanent = FALSE;
	important = TRUE;
};


func int DIA_Fernando_Minental_Condition()
{
	if((NpcObsessedByDMT_Fernando == FALSE) && (MIS_OLDWORLD == LOG_Running) && (EnterOW_Kapitel2 == FALSE) && (Fernando_Betrayal == FALSE) && (Fernando_ImKnast == FALSE))
	{
		return TRUE;
	};
};

func void DIA_Fernando_Minental_Info()
{
	AI_Output(self,other,"DIA_Fernando_Minental_14_00");	//Эй, ты - подожди минутку. Ты ведь направляешься в Долину Рудников, да?
	AI_Output(other,self,"DIA_Fernando_Minental_15_01");	//И?
	AI_Output(self,other,"DIA_Fernando_Minental_14_02");	//Я хочу предложить тебе сделку. Ты приносишь мне доклад о том, что там происходит с рудой, а за это я дам тебе...
	if(other.guild == GIL_KDF)
	{
		AI_Output(self,other,"DIA_Fernando_Minental_14_03");	//... рунный камень.
	}
	else
	{
		AI_Output(self,other,"DIA_Fernando_Minental_14_04");	//... кольцо, которое повысит твои жизненные силы.
	};
	AI_Output(other,self,"DIA_Fernando_Minental_15_05");	//Я посмотрю, что можно сделать.
	B_NpcClearObsessionByDMT(self);
	Npc_ExchangeRoutine(self,"START");
	MIS_Fernando_Erz = LOG_Running;
	Log_CreateTopic(TOPIC_Fernando,LOG_MISSION);
	Log_SetTopicStatus(TOPIC_Fernando,LOG_Running);
	B_LogEntry(TOPIC_Fernando,"Торговец Фернандо хочет знать, как обстоят дела с рудой в Долине Рудников.");
};


instance DIA_Addon_Fernando_BanditTrader(C_Info)
{
	npc = VLK_405_Fernando;
	nr = 5;
	condition = DIA_Addon_Fernando_BanditTrader_Condition;
	information = DIA_Addon_Fernando_BanditTrader_Info;
	permanent = TRUE;
	description = "Ты продаешь оружие бандитам.";
};


func int DIA_Addon_Fernando_BanditTrader_Condition()
{
	if((FernandoBlame_noPerm == FALSE) && (MIS_Vatras_FindTheBanditTrader == LOG_Running) && Npc_KnowsInfo(other,DIA_Fernando_Hello) && (NpcObsessedByDMT_Fernando == FALSE) && C_SCHasAnyFernandoEvidence() && (Fernando_ImKnast == FALSE))
	{
		return TRUE;
	};
};

func void DIA_Addon_Fernando_BanditTrader_Info()
{
	AI_Output(other,self,"DIA_Addon_Fernando_BanditTrader_15_00");	//Ты продаешь оружие бандитам.
	AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_14_01");	//(недоуменно) Почему это ты так решил?
	FernandoMajorEvidenceCount = 0;
	if(Npc_HasItems(other,ItWr_Addon_BanditTrader) && (BanditTrader_Lieferung_Gelesen == TRUE))
	{
		AI_Output(other,self,"DIA_Addon_Fernando_BanditTrader_15_02");	//На списке проданных товаров, который я нашел у бандитов, стоит твоя подпись.
		FernandoMajorEvidenceCount += 3;
	};
	if(Npc_HasItems(other,ItRi_Addon_BanditTrader))
	{
		AI_Output(other,self,"DIA_Addon_Fernando_BanditTrader_15_03");	//У бандитов я нашел кольцо гильдии морских торговцев Араксоса. Ты - морской торговец.
		FernandoMajorEvidenceCount += 1;
		if(Npc_HasItems(other,ItMw_Addon_BanditTrader))
		{
			AI_Output(other,self,"DIA_Addon_Fernando_BanditTrader_15_04");	//А на мечах, которые были у бандитов, стоят твои инициалы.
			FernandoMajorEvidenceCount += 1;
		};
	}
	else if(Npc_HasItems(other,ItMw_Addon_BanditTrader))
	{
		AI_Output(other,self,"DIA_Addon_Fernando_BanditTrader_15_05");	//На мечах, которые были у бандитов, стоят твои инициалы.
		FernandoMajorEvidenceCount += 1;
	};
	if(FernandoMajorEvidenceCount < 2)
	{
		DIA_Cord_And();
		AI_Output(other,self,"DIA_Addon_Cavalorn_Banditen_15_02");	//Э-э...
		if((other.guild == GIL_MIL) || (other.guild == GIL_PAL) || (other.guild == GIL_KDF))
		{
			B_Say(self,other,"$SPAREME");
		}
		else
		{
			B_Say(self,other,"$NOTNOW");
		};
		B_NpcClearObsessionByDMT(self);
	}
	else
	{
		AI_Output(other,self,"DIA_Addon_Fernando_BanditTrader_15_06");	//Теперь тебе не отвертеться. Я тебя раскрыл.
		B_LogEntry(TOPIC_Addon_Bandittrader,"Крупный торговец Фернандо признал, что поставлял оружие бандитам.");
		B_GivePlayerXP(XP_Addon_Fernando_HatsZugegeben);
		FernandoBlame_noPerm = TRUE;
		Fernando_HatsZugegeben = TRUE;
		AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_14_10");	//(умоляюще) Я не хотел этого делать! Поверь мне!
		AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_14_11");	//(умоляюще) Сначала я продавал им только еду. Дела у меня шли неважно, и это было для меня единственным выходом.
		AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_14_12");	//(умоляюще) Но потом бандиты стали агрессивными и даже угрожали убить меня, если я не продам им оружие.
		AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_14_13");	//(умоляюще) Ты не можешь обвинять меня! Я всего лишь жертва обстоятельств.
		Info_ClearChoices(DIA_Addon_Fernando_BanditTrader);
		Info_AddChoice(DIA_Addon_Fernando_BanditTrader,"Сколько ты мне заплатишь, если я тебя отпущу?",DIA_Addon_Fernando_BanditTrader_preis);
		Info_AddChoice(DIA_Addon_Fernando_BanditTrader,"С тобой разберется ополчение.",DIA_Addon_Fernando_BanditTrader_mil);
		Info_AddChoice(DIA_Addon_Fernando_BanditTrader,"Не пытайся взять меня на жалость. Ты просто отвратительный и жадный торгаш.",DIA_Addon_Fernando_BanditTrader_Uptown);
	};
};

func void DIA_Addon_Fernando_BanditTrader_Uptown()
{
	AI_Output(other,self,"DIA_Addon_Fernando_BanditTrader_Uptown_15_00");	//Не пытайся взять меня на жалость. Ты просто отвратительный и жадный торгаш.
	AI_Output(other,self,"DIA_Addon_Fernando_BanditTrader_Uptown_15_01");	//За пригоршню золотых ты душу готов продать.
	AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_Uptown_14_02");	//Но у меня множество расходов! Если я не буду платить, меня могут попросту пустить на корм рыбам.
};

func void DIA_Addon_Fernando_BanditTrader_mil()
{
	AI_Output(other,self,"DIA_Addon_Fernando_BanditTrader_mil_15_00");	//С тобой разберется ополчение.
	AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_mil_14_01");	//Ты не можешь так поступить!
	AI_Output(other,self,"DIA_Addon_Fernando_BanditTrader_mil_15_02");	//Еще как могу. Сам увидишь.
	AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_mil_14_03");	//О, Иннос! Я пропал!
	Fernando_Betrayal = TRUE;
	B_NpcClearObsessionByDMT(self);
};

func void DIA_Addon_Fernando_BanditTrader_preis()
{
	AI_Output(other,self,"DIA_Addon_Fernando_BanditTrader_preis_15_00");	//Сколько ты мне заплатишь, если я тебя отпущу?
	AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_preis_14_01");	//Дела у меня идут неважно. Много я заплатить не смогу.
	AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_preis_14_02");	//Скажем, 200 золотых и ценное кольцо?
	AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_preis_14_03");	//Этого должно хватить. Ну что, ты отдашь мне свои улики?
	Info_ClearChoices(DIA_Addon_Fernando_BanditTrader);
	Info_AddChoice(DIA_Addon_Fernando_BanditTrader,"Нет, пожалуй, я оставлю их себе.",DIA_Addon_Fernando_BanditTrader_nein);
	Info_AddChoice(DIA_Addon_Fernando_BanditTrader,"Ну хорошо, я согласен.",DIA_Addon_Fernando_BanditTrader_ja);
};

func void DIA_Addon_Fernando_BanditTrader_ja()
{
	AI_Output(other,self,"DIA_Addon_Fernando_BanditTrader_ja_15_00");	//Ну хорошо, я согласен.
	B_GivePlayerXP(XP_Ambient);
	FernandoMajorEvidenceCount = 0;
	if(Npc_HasItems(other,ItMw_Addon_BanditTrader))
	{
		Npc_RemoveInvItems(other,ItMw_Addon_BanditTrader,Npc_HasItems(other,ItMw_Addon_BanditTrader));
	};
	if(Npc_HasItems(other,ItRi_Addon_BanditTrader))
	{
		Npc_RemoveInvItem(other,ItRi_Addon_BanditTrader);
		FernandoMajorEvidenceCount += 1;
	};
	if(Npc_HasItems(other,ItWr_Addon_BanditTrader))
	{
		Npc_RemoveInvItem(other,ItWr_Addon_BanditTrader);
		FernandoMajorEvidenceCount += 1;
	};
	AI_PrintScreen(PRINT_Addon_EvidenceGiven,-1,YPOS_ItemGiven,FONT_ScreenSmall,2);
	AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_ja_14_01");	//Хорошо, вот золото.
	CreateInvItems(self,ItMi_Gold,200);
	B_GiveInvItems(self,other,ItMi_Gold,200);
	AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_ja_14_02");	//И кольцо. Мы в расчете.
	if(FernandoMajorEvidenceCount < 2)
	{
		CreateInvItems(self,ItRi_Prot_Point_01,1);
		B_GiveInvItems(self,other,ItRi_Prot_Point_01,1);
	}
	else
	{
		CreateInvItems(self,ItRi_Prot_Total_03,1);
		B_GiveInvItems(self,other,ItRi_Prot_Total_03,1);
		MIS_Martin_FindTheBanditTrader = LOG_FAILED;
		MIS_Vatras_FindTheBanditTrader = LOG_FAILED;
		B_LogEntry(TOPIC_Addon_Bandittrader,"Я решил не отправлять Фернандо в тюрьму и отдал ему все улики.");
		B_CheckLog();
	};
	Info_ClearChoices(DIA_Addon_Fernando_BanditTrader);
};

func void DIA_Addon_Fernando_BanditTrader_nein()
{
	AI_Output(other,self,"DIA_Addon_Fernando_BanditTrader_nein_15_00");	//Нет, пожалуй, я оставлю их себе.
	AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_nein_14_01");	//Как хочешь. Но предупреждаю: если ты меня выдашь, тебе не поздоровится.
	Fernando_Betrayal = TRUE;
	Info_ClearChoices(DIA_Addon_Fernando_BanditTrader);
};


instance DIA_Fernando_Success(C_Info)
{
	npc = VLK_405_Fernando;
	nr = 5;
	condition = DIA_Fernando_Success_Condition;
	information = DIA_Fernando_Success_Info;
	permanent = FALSE;
	description = "Я был в Долине Рудников.";
};


func int DIA_Fernando_Success_Condition()
{
	if((Kapitel >= 3) && (MIS_Fernando_Erz == LOG_Running))
	{
		return TRUE;
	};
};

func void DIA_Fernando_Success_Info()
{
	AI_Output(other,self,"DIA_Fernando_Success_15_00");	//Я был в Долине Рудников.
	if((Fernando_ImKnast == FALSE) && (NpcObsessedByDMT_Fernando == FALSE))
	{
		MIS_Fernando_Erz = LOG_SUCCESS;
		B_GivePlayerXP(XP_Ambient);
		AI_Output(self,other,"DIA_Fernando_Success_14_01");	//И? Как там обстоят дела?
		AI_Output(other,self,"DIA_Fernando_Success_15_02");	//Шахты истощены, там можно добыть всего каких-нибудь несколько ящиков руды. Вряд ли эта овчинка стоит выделки.
		AI_Output(self,other,"DIA_Fernando_Success_14_03");	//Этого не может быть! Это означает, что я разорен...
		AI_Output(other,self,"DIA_Fernando_Success_15_04");	//Что насчет нашей сделки?
		if(Fernando_Betrayal == FALSE)
		{
			AI_Output(self,other,"DIA_Fernando_Success_14_05");	//Ах, да, твое вознаграждение...
			if(other.guild == GIL_KDF)
			{
				AI_Output(self,other,"DIA_Fernando_Minental_14_06");	//Вот, держи этот рунный камень.
				B_GiveInvItems(self,other,ItMi_RuneBlank,1);
			}
			else
			{
				AI_Output(self,other,"DIA_Fernando_Minental_14_07");	//Вот твое кольцо.
				B_GiveInvItems(self,other,ItRi_HP_02,1);
			};
		}
		else
		{
			B_Say(self,other,"$NOTNOW");
			AI_StopProcessInfos(self);
		};
	}
	else
	{
		B_Say(self,other,"$NOTNOW");
		B_LogEntry(TOPIC_Fernando,"Фернандо больше не нуждается в информации. И денег за нее он мне не заплатит.");
		MIS_Fernando_Erz = LOG_FAILED;
		B_CheckLog();
	};
};


var int Fernando_ThreatFromPrison;

instance DIA_Fernando_Prison(C_Info)
{
	npc = VLK_405_Fernando;
	nr = 3;
	condition = DIA_Fernando_Prison_Condition;
	information = DIA_Fernando_Prison_Info;
	permanent = TRUE;
	important = TRUE;
};


func int DIA_Fernando_Prison_Condition()
{
	if((Fernando_ImKnast == TRUE) && Npc_IsInState(self,ZS_Talk) && (NpcObsessedByDMT_Fernando == FALSE))
	{
		if((Kapitel >= 3) && (hero.guild == GIL_KDF))
		{
			return FALSE;
		};
		return TRUE;
	};
};

func void DIA_Fernando_Prison_Info()
{
	if(Fernando_ThreatFromPrison == FALSE)
	{
		AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_14_07");	//Так это сделал ТЫ! Ты меня выдал! Я заставлю тебя заплатить за это.
		AI_Output(other,self,"DIA_Addon_Fernando_BanditTrader_15_08");	//Сначала тебе придется отсюда выйти, а я думаю, что вряд ли тебя отпустят в ближайшее время.
		Fernando_ThreatFromPrison = TRUE;
	};
	AI_Output(self,other,"DIA_Addon_Fernando_BanditTrader_14_09");	//(зло) Ничего, мое время еще придет.
	B_NpcClearObsessionByDMT(self);
};


instance DIA_Fernando_Obsession(C_Info)
{
	npc = VLK_405_Fernando;
	nr = 30;
	condition = DIA_Fernando_Obsession_Condition;
	information = DIA_Fernando_Obsession_Info;
	description = "Все в порядке?";
};


func int DIA_Fernando_Obsession_Condition()
{
	if((Kapitel >= 3) && (NpcObsessedByDMT_Fernando == FALSE) && (hero.guild == GIL_KDF))
	{
		return TRUE;
	};
};

func void DIA_Fernando_Obsession_Info()
{
	DIA_Common_IsEverythingOk();
	B_NpcObsessedByDMT(self);
};


instance DIA_Fernando_Heilung(C_Info)
{
	npc = VLK_405_Fernando;
	nr = 55;
	condition = DIA_Fernando_Heilung_Condition;
	information = DIA_Fernando_Heilung_Info;
	permanent = TRUE;
	description = "Ты одержим!";
};


func int DIA_Fernando_Heilung_Condition()
{
	if((NpcObsessedByDMT_Fernando == TRUE) && (NpcObsessedByDMT == FALSE) && (hero.guild == GIL_KDF))
	{
		return TRUE;
	};
};

func void DIA_Fernando_Heilung_Info()
{
	AI_Output(other,self,"DIA_Fernando_Heilung_15_00");	//Ты одержим!
	AI_Output(self,other,"DIA_Fernando_Heilung_14_01");	//Уходи. Уходи немедленно.
	B_NpcClearObsessionByDMT(self);
};

